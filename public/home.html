<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f4f4f4;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: #ccc;
            color: black;
        }
        .header button {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: black;
        }
        .container {
            display: flex;
            flex: 1;
        }
        .sidebar {
            width: 250px;
            background: #333;
            color: white;
            overflow-y: auto;
            transition: width 0.3s;
        }
        .sidebar.hidden {
            width: 0;
            overflow: hidden;
        }
        .sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .sidebar ul li {
            padding: 10px;
            border-bottom: 1px solid #444;
            cursor: pointer;
        }
        .sidebar ul li:hover {
            background: #444;
        }
        .sidebar button {
            width: 100%;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        .sidebar button:hover {
            background: #0056b3;
        }
        .chat-box {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 10px;
            display: flex;
            flex-direction: column;
            position: relative;
            transition: margin-left 0.3s;
        }
        .messages {
            flex: 1;
            overflow-y: auto;
            padding-bottom: 10px;
            display: flex;
            flex-direction: column;
        }
        .message {
            padding: 10px;
            border-radius: 10px;
            margin: 5px 0;
            max-width: 60%;
        }
        .user-message {
            background: #3e8ee3;
            color: rgb(6, 0, 0);
            align-self: flex-end;
        }
        .bot-message {
            background: #fbfafa;
            color: black;
            align-self: flex-start;
        }
        .file-message {
            background: #f0ad4e;
            color: white;
            align-self: flex-start;
        }
        .input-area {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 30px;
            padding: 10px;
            margin: 10px;
            border: 1px solid #ccc;
        }
        .input-area input {
            flex: 1;
            padding: 10px;
            border: none;
            outline: none;
            border-radius: 5px;
        }
        .input-area button {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
        }
        .dark-mode .chat-box {
            background: #333;
            color: rgb(2, 0, 0);
        }

        .disease-response {
    background: #f8f9fa;
    border-radius: 10px;
    padding: 15px;
    margin-top: 10px;
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
}

.disease-response h3 {
    font-size: 18px;
    color: #007bff;
    display: flex;
    align-items: center;
    gap: 5px;
}

.disease-response table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
}

.disease-response th {
    background: blue;
    color: rgb(1, 0, 0);
    padding: 8px;
    text-align: left;
}

.disease-response td {
    padding: 8px;
    border: 1px solid #080000;
    word-wrap: break-word;
    white-space: normal;
}

.disease-response td:first-child {
    font-weight: bold;
    width: 30%;
}


    </style>
    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
</head>
<body>
    <div class="header">
        <button onclick="toggleTheme()">üåô</button>
        <div>
            <a href="profile.html" class="btn">üë§</a>
            <a href="contact.html" class="btn">üìû</a>
        </div>
    </div>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <button onclick="startNewChat()">New Chat </button>
            <button onclick="clearAllChats()">üóëÔ∏è Clear Chats</button>

            <ul id="previousChats"></ul>
        </div>
        <div class="chat-box" id="chatBox">
            <div class="messages" id="messages"></div>
            <div class="input-area">
                <input type="file" id="fileInput" style="display: none;" onchange="handleFileUpload()">
                <button onclick="document.getElementById('fileInput').click()">üìÇ</button>
                <input type="text" id="userInput" placeholder="Type a message...">
                
                
                <button onclick="startVoiceInput()">üé§</button>
                <button onclick="sendMessage()">üì©</button>
            </div>
            
        </div>
    </div>
    <div style="text-align:right; margin: 10px;">
        <label for="languageSelect">üåê Language:</label>
        <select id="languageSelect">
            <option value="english" selected>English</option>
            <option value="hindi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
            <option value="marathi">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
        </select>
    </div>
    <script>
     let currentUtterance = null;
    let currentChat = [];
    let previousChats = [];
    let dataset = [];

    function getLanguagePrompt(basePrompt) {
        const lang = document.getElementById("languageSelect").value;
        if (lang === "hindi") {
            return `Translate and respond in Hindi: ${basePrompt}`;
        } else if (lang === "marathi") {
            return `Translate and respond in Marathi: ${basePrompt}`;
        }
        return basePrompt; // English
    }

    async function callAkashChat(prompt) {
    const langPrompt = getLanguagePrompt(prompt);
    const response = await fetch("https://chatapi.akash.network/api/v1/chat/completions", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer sk-zL_kOY1PF1vm0n3I5Eu1dw"
        },
        body: JSON.stringify({
            model: "Qwen3-235B-A22B-FP8",
            messages: [
                { role: "user", content: langPrompt }
            ]
        })
    });

    const data = await response.json();
    let content = data?.choices?.[0]?.message?.content || "Sorry, I couldn't process that.";

    // Remove <think>...</think> block if it exists
    content = content.replace(/<think>[\s\S]*?<\/think>/g, '').trim();

    return content;
}

    function isSymptomInput(input) {
        const userSymptoms = input.toLowerCase().split(',').map(s => s.trim()).filter(Boolean);
        if (userSymptoms.length === 0) return null;

        for (let row of dataset) {
            const rowSymptoms = row["Symptoms"]?.toLowerCase().split(',').map(s => s.trim()).filter(Boolean);
            if (!rowSymptoms || rowSymptoms.length === 0) continue;

            const allMatch = userSymptoms.every(symptom => rowSymptoms.includes(symptom));
            if (allMatch) {
                return {
                    disease: row["Disease Name"],
                    precaution: row["Precautions"],
                    diet: row["Diet Plan"],
                    remedy: row["Home Remedies"],
                    symptoms: row["Symptoms"]
                };
            }
        }
        return null;
    }

    function handleFileUpload() {
        const file = document.getElementById('fileInput').files[0];
        if (file) {
            Papa.parse(file, {
                header: true,
                complete: function (results) {
                    dataset = results.data;
                    alert("Dataset uploaded successfully!");
                }
            });
        }
    }
    
    function pauseReading() {
    if (speechSynthesis.speaking && !speechSynthesis.paused) {
        speechSynthesis.pause();
    }
}

function resumeReading() {
    if (speechSynthesis.paused) {
        speechSynthesis.resume();
    }
}


function addMessage(text, isUser = true) {
    const message = document.createElement("div");
    message.classList.add("message", isUser ? "user-message" : "bot-message");
    message.innerText = text;

    if (!isUser) {
        const readButton = document.createElement("button");
        readButton.innerText = "üîä";
        readButton.style.marginLeft = "10px";
        readButton.onclick = function () {
            readAloud(text, this);
        };
        message.appendChild(readButton);
    }

    document.getElementById("messages").appendChild(message);
    document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;

    // ‚úÖ Save to current chat history
    currentChat.push({
        sender: isUser ? "user-message" : "bot-message",
        message: text
    });
    
   
}


    async function sendMessage() {
    const inputField = document.getElementById("userInput");
    const userInput = inputField.value.trim();
    if (!userInput) return;

    addMessage(userInput, true);
    inputField.value = "";

    const matched = dataset && dataset.length > 0 ? isSymptomInput(userInput) : null;

    if (matched) {
        const matchedRow = dataset.find(row => row["Disease Name"] === matched.disease);

        // Prepare unformatted plain text response for translation
        const responseText = `
Disease: ${matched.disease}
Symptoms: ${matchedRow?.Symptoms || "N/A"}
Precautions: ${matched.precaution || "N/A"}
Diet Plan: ${matched.diet || "N/A"}
Home Remedies: ${matched.remedy || "N/A"}
        `.trim();

        const lang = document.getElementById("languageSelect").value;
        let translated = {
            disease: matched.disease,
            symptoms: matchedRow?.Symptoms || "N/A",
            precaution: matched.precaution || "N/A",
            diet: matched.diet || "N/A",
            remedy: matched.remedy || "N/A"
        };

        // If not English, translate each field separately for accurate structure
        if (lang !== "english") {
            const [disease, symptoms, precaution, diet, remedy] = await Promise.all([
                callAkashChat(`Translate this to ${lang}: ${translated.disease}`),
                callAkashChat(`Translate this to ${lang}: ${translated.symptoms}`),
                callAkashChat(`Translate this to ${lang}: ${translated.precaution}`),
                callAkashChat(`Translate this to ${lang}: ${translated.diet}`),
                callAkashChat(`Translate this to ${lang}: ${translated.remedy}`)
            ]);

            translated = { disease, symptoms, precaution, diet, remedy };
        }

        // Create table UI
        const responseDiv = document.createElement("div");
        responseDiv.classList.add("disease-response");
        responseDiv.innerHTML = `
            <h3>ü©∫ Disease Prediction: ${translated.disease}</h3>
            <table>
                <tr><th>Disease Name</th><td>${translated.disease}</td></tr>
                <tr><th>Symptoms</th><td>${translated.symptoms}</td></tr>
                <tr><th>Precautions</th><td>${translated.precaution}</td></tr>
                <tr><th>Diet Plan</th><td>${translated.diet}</td></tr>
                <tr><th>Home Remedies</th><td>${translated.remedy}</td></tr>
            </table>
            <button class="read-table-button" onclick="readAloudTable(this.previousElementSibling, this)">üîä Read Aloud</button>

        `;
        document.getElementById("messages").appendChild(responseDiv);
        document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;

    } else {
        // Fallback to generic bot response
        const botReply = await callAkashChat(userInput);
        addMessage(botReply, false);
    }
}

    function toggleTheme() {
        document.body.classList.toggle("dark-mode");
    }

    function startNewChat() {
    if (currentChat.length > 0) {
        let storedChats = JSON.parse(sessionStorage.getItem("chatHistory")) || [];
        storedChats.push(currentChat);
        sessionStorage.setItem("chatHistory", JSON.stringify(storedChats));
        loadChatTitles(); // üëà Refresh sidebar
    }

    document.getElementById("messages").innerHTML = "";
    currentChat = [];
}
function clearAllChats() {
    sessionStorage.removeItem("chatHistory");
    currentChat = [];
    document.getElementById("messages").innerHTML = "";
    loadChatTitles();
}


function loadPreviousChats() {
    const storedChats = JSON.parse(sessionStorage.getItem("chatHistory")) || [];
    const messagesContainer = document.getElementById("messages");

    storedChats.forEach((chat, index) => {
        const separator = document.createElement("div");
        separator.innerHTML = `<hr><strong>Previous Chat ${index + 1}</strong>`;
        messagesContainer.appendChild(separator);

        chat.forEach(msg => {
            const div = document.createElement("div");
            div.className = msg.sender;
            div.textContent = msg.message;
            messagesContainer.appendChild(div);
        });
    });
}


    function startVoiceInput() {
        const recognition = new webkitSpeechRecognition();
        recognition.lang = "en-US";
        recognition.onresult = function (event) {
            document.getElementById("userInput").value = event.results[0][0].transcript;
        };
        recognition.start();
    }

    let isReading = false;
let isPaused = false;

function readAloud(text, button) {
    if (!window.speechSynthesis) {
        alert("Sorry, your browser doesn't support speech synthesis.");
        return;
    }

    if (isReading && !isPaused) {
        speechSynthesis.pause();
        isPaused = true;
        button.innerText = "‚ñ∂Ô∏è"; // Show play icon
        return;
    } else if (isReading && isPaused) {
        speechSynthesis.resume();
        isPaused = false;
        button.innerText = "‚è∏Ô∏è"; // Show pause icon
        return;
    }

    // Start reading fresh
    speechSynthesis.cancel();
    currentUtterance = new SpeechSynthesisUtterance(text);
    const lang = document.getElementById("languageSelect").value;
    currentUtterance.lang = lang === "hindi" ? "hi-IN" : lang === "marathi" ? "mr-IN" : "en-US";

    currentUtterance.onstart = () => {
        isReading = true;
        isPaused = false;
        button.innerText = "‚è∏Ô∏è";
    };
    currentUtterance.onend = () => {
        isReading = false;
        isPaused = false;
        button.innerText = "üîä";
    };

    speechSynthesis.speak(currentUtterance);
}



    // Auto-load dataset from GitHub
    window.onload = function () {
        Papa.parse("https://raw.githubusercontent.com/vaibhavshinde8478/Healthcare-Chatbot/main/most_common_100_diseases_full.csv", {
            download: true,
            header: true,
            complete: function (results) {
                dataset = results.data;
                console.log("Dataset loaded from GitHub");
            }
        });
        loadChatTitles(); // üëà Load chat titles into sidebar
    }

    function loadChatTitles() {
    const storedChats = JSON.parse(sessionStorage.getItem("chatHistory")) || [];
    const list = document.getElementById("previousChats");
    list.innerHTML = "";

    storedChats.forEach((_, index) => {
        const li = document.createElement("li");
        li.innerText = `Chat ${index + 1}`;
        li.onclick = () => loadChatByIndex(index);
        list.appendChild(li);
    });
}

function loadChatByIndex(index) {
    const storedChats = JSON.parse(sessionStorage.getItem("chatHistory")) || [];
    if (storedChats[index]) {
        document.getElementById("messages").innerHTML = "";
        currentChat = [...storedChats[index]];

        currentChat.forEach(msg => {
            if (msg.sender === "bot-message" || msg.sender === "user-message") {
                addMessage(msg.message, msg.sender === "user-message");
            } else {
                // Fallback in case of structured disease message (optional)
                const div = document.createElement("div");
                div.className = msg.sender;
                div.textContent = msg.message;
                document.getElementById("messages").appendChild(div);
            }
        });
    }
}

    function readAloudTable(tableElement, button) {
    if (!window.speechSynthesis) {
        alert("Sorry, your browser doesn't support speech synthesis.");
        return;
    }

    if (isReading && !isPaused) {
        speechSynthesis.pause();
        isPaused = true;
        button.innerText = "‚ñ∂Ô∏è";
        return;
    } else if (isReading && isPaused) {
        speechSynthesis.resume();
        isPaused = false;
        button.innerText = "‚è∏Ô∏è";
        return;
    }

    const rows = Array.from(tableElement.querySelectorAll("tr"));
    const text = rows.map(row => {
        const cells = row.querySelectorAll("th, td");
        return cells.length === 2 ? `${cells[0].innerText}: ${cells[1].innerText}` : "";
    }).join(". ");

    speechSynthesis.cancel();
    currentUtterance = new SpeechSynthesisUtterance(text);
    const lang = document.getElementById("languageSelect").value;
    currentUtterance.lang = lang === "hindi" ? "hi-IN" : lang === "marathi" ? "mr-IN" : "en-US";

    currentUtterance.onstart = () => {
        isReading = true;
        isPaused = false;
        button.innerText = "‚è∏Ô∏è";
    };
    currentUtterance.onend = () => {
        isReading = false;
        isPaused = false;
        button.innerText = "üîä";
    };

    speechSynthesis.speak(currentUtterance);
}



</script>

    

</body>
<!-- </html>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 -->
<!-- async function sendMessage() {
    const inputField = document.getElementById("userInput");
    const userInput = inputField.value.trim();
    if (!userInput) return;

    addMessage(userInput, true);
    inputField.value = "";

    // Check for symptoms match only if dataset is available
    let matched = null;
    if (dataset && dataset.length > 0) {
        matched = isSymptomInput(userInput);
    }

    if (matched) {
        const matchedRow = dataset.find(row => row["Disease Name"] === matched.disease);
        const responseDiv = document.createElement("div");
        responseDiv.classList.add("disease-response");
        responseDiv.innerHTML = `
            <h3>ü©∫ Disease Prediction: ${matched.disease}</h3>
            <table>
                <tr><th>Disease Name</th><td>${matched.disease}</td></tr>
                <tr><th>Symptoms</th><td>${matchedRow?.Symptoms || "N/A"}</td></tr>
                <tr><th>Precautions</th><td>${matched.precaution}</td></tr>
                <tr><th>Diet Plan</th><td>${matched.diet}</td></tr>
                <tr><th>Home Remedies</th><td>${matched.remedy}</td></tr>
            </table>
            <button class="read-table-button" onclick="readAloudTable(this.previousElementSibling)">üîä Read Aloud</button>
        `;
        document.getElementById("messages").appendChild(responseDiv);
        document.getElementById("messages").scrollTop = document.getElementById("messages").scrollHeight;
    } else {
        // Always fallback to model
        const botReply = await callOpenRouter(userInput);
        addMessage(botReply, false);
    }
} -->



<!-- akash network api sk-zL_kOY1PF1vm0n3I5Eu1dw -->